# UGOKU One Inverted Pendulum (対向2輪・倒立振子 サンプル)
UGOKU Oneで対向2輪ロボットをDCモーター車輪で自立させる倒立振子プログラムです。UGOKU PadからPIDゲインをリアルタイムに調整できます。

**注意:** 本スケッチの制御は構築中で、現時点では不完全です。機体の個体差・組付け・センサ搭載向きによっては期待どおりに安定しない可能性があります。必ず浮かせた状態/安全確保のうえで調整してください。

### UGOKU Pad
https://ugoku-lab.github.io/ugokupad.html

Console内の「ESP32 Arduino Sample」を使用

<img src="https://github.com/user-attachments/assets/a0c7ed43-5082-4802-9647-cbb8cc861142" width="200">
<img src="https://github.com/user-attachments/assets/578605c3-9ea8-434b-b564-59bf12aa8233" width="200">

### できること
- BMI270(IMU)で姿勢（ピッチ）を推定（コンプリメンタリフィルタ）
- PID制御で左右DCモーターを同方向駆動し、倒立を保持
- UGOKU Padから Kp/Ki/Kd と角度トリムを調整

### 使用ライブラリ
- Arduino標準ライブラリ
- Arduino_BMI270_BMM150（Arduino公式 IMU ライブラリ）

インストール方法: Arduino IDE の「ライブラリを管理…」で「Arduino_BMI270_BMM150」を検索してインストール。

## 使い方
1. UGOKU Pad と接続・チューニング
	- チャンネル割り当て（0..180 がスライダ/スティックの範囲）
	  - ch2: Kp（0..40）
	  - ch3: Ki（0..2）
	  - ch4: Kd（0..2）
	  - ch5: 角度トリム（-90..+90 度; 90が0度）※安全のためスケッチ側で ±45° に制限
	- PIDゲインの調整手順（目安）
	  - まず Ki=0 にして、Kp を少しずつ上げて「倒れたら戻す」力を作る（上げすぎると高速振動しやすい）
	  - 次に Kd を足して振動/揺れを減らす（入れすぎると反応が鈍くなりやすい）
	  - 最後に Ki をごく少量足して、傾きの残り（定常偏差）を消す（入れすぎると風袋や摩擦で暴れやすい）
	  - 反応が逆/鈍い場合は「軸・向きの調整」を先に確認

	- ゲインや角度が反映されないことがあるので、反映されている値をUGOKU Padで確認しながら使用してください。
	- UGOKU Padへ送信するチャンネル（0..180; 90が0度）
	  - ch20: 現在角（接続時の姿勢を基準にした相対角）
	  - ch21: 目標角（ch5の角度トリム）
	  - ch22: Kp 表示（0..40 を 0..180 にスケール）
	  - ch23: Ki 表示（0..2 を 0..180 にスケール）
	  - ch24: Kd 表示（0..2 を 0..180 にスケール）

2. モーターの回転向きが逆の場合
	- GPIO34/35 DIPスイッチ状態で切り替え（HIGH=通常 / LOW=反転）



